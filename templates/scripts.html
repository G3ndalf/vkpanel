{% extends "base.html" %}

{% block title %}–°–∫—Ä–∏–ø—Ç—ã {{ server.name }} ‚Äî VK IP Panel{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 0.75rem;">
    <h1>üìú –°–∫—Ä–∏–ø—Ç—ã: {{ server.name }}</h1>
    <div style="display: flex; gap: 0.5rem;">
        <button class="btn btn-primary" onclick="refreshScripts()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        <a href="/servers" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º</a>
    </div>
</div>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ -->
<div class="card">
    <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç</h2>
    <form method="POST" action="/servers/{{ server.id }}/scripts/add">
        <div class="form-row">
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input type="text" name="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: project-1" required>
            </div>
            <div class="form-group">
                <label>–ü—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É</label>
                <input type="text" name="path" placeholder="/opt/vkip/project1" required>
            </div>
            <div class="form-group">
                <label>–ò–º—è systemd —Å–µ—Ä–≤–∏—Å–∞</label>
                <input type="text" name="service_name" placeholder="vkip-project1" required>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label>–ê–∫–∫–∞—É–Ω—Ç VK Cloud (OS_USERNAME)</label>
                <input type="text" name="account_name" placeholder="user@mail.ru">
            </div>
            <div class="form-group">
                <label>–ü—Ä–æ–µ–∫—Ç (OS_PROJECT_NAME)</label>
                <input type="text" name="project_name" placeholder="project-abc">
            </div>
        </div>
        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç</button>
    </form>
</div>

<!-- –°–ø–∏—Å–æ–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ -->
<div class="card">
    <h2>üìã –°–∫—Ä–∏–ø—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ</h2>
    
    {% if scripts %}
    <div class="table-responsive">
    <table>
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–ü—É—Ç—å</th>
                <th>–°–µ—Ä–≤–∏—Å</th>
                <th>–ê–∫–∫–∞—É–Ω—Ç</th>
                <th>–ü—Ä–æ–µ–∫—Ç</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–¶–∏–∫–ª–æ–≤</th>
                <th>–£—Å–ø–µ—Ö–æ–≤</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for item in scripts %}
            <tr>
                <td><strong>{{ item.script.name }}</strong></td>
                <td><code style="font-size: 0.8rem;">{{ item.script.path }}</code></td>
                <td><code style="font-size: 0.8rem;">{{ item.script.service_name }}</code></td>
                <td>{{ item.script.account_name or '-' }}</td>
                <td>{{ item.script.project_name or '-' }}</td>
                <td>
                    {% if item.status.error %}
                    <span class="badge badge-yellow" title="{{ item.status.error }}">–û—à–∏–±–∫–∞</span>
                    {% elif item.status.running %}
                    <span class="badge badge-green">–†–∞–±–æ—Ç–∞–µ—Ç</span>
                    {% else %}
                    <span class="badge badge-red">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span>
                    {% endif %}
                </td>
                <td>{{ item.status.cycles }}</td>
                <td>{{ item.status.success }}</td>
                <td>
                    <div class="actions">
                        {% if item.status.running %}
                        <form method="POST" action="/servers/{{ server.id }}/scripts/{{ item.script.id }}/stop" style="display:inline;">
                            <button type="submit" class="btn btn-secondary btn-sm">–°—Ç–æ–ø</button>
                        </form>
                        <form method="POST" action="/servers/{{ server.id }}/scripts/{{ item.script.id }}/restart" style="display:inline;">
                            <button type="submit" class="btn btn-secondary btn-sm">–†–µ—Å—Ç–∞—Ä—Ç</button>
                        </form>
                        {% else %}
                        <form method="POST" action="/servers/{{ server.id }}/scripts/{{ item.script.id }}/start" style="display:inline;">
                            <button type="submit" class="btn btn-primary btn-sm">–°—Ç–∞—Ä—Ç</button>
                        </form>
                        {% endif %}
                        <form method="POST" action="/servers/{{ server.id }}/scripts/{{ item.script.id }}/delete" style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Å–∫—Ä–∏–ø—Ç?');">
                            <button type="submit" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
    {% else %}
    <div class="empty">
        <p>–°–∫—Ä–∏–ø—Ç–æ–≤ –Ω–∞ —ç—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–µ –ø–æ–∫–∞ –Ω–µ—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π —Å–∫—Ä–∏–ø—Ç –≤—ã—à–µ.</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
function refreshScripts() {
    location.reload();
}
</script>
{% endblock %}
